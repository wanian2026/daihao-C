# 市场休眠开关使用说明

## 功能概述

市场休眠开关是一个重要的控制选项，允许您手动控制是否启用市场休眠过滤功能。

### 功能说明

- **启用时（勾选状态）**：系统会判断市场是否处于休眠状态（波动过低、成交量低迷、负资金费率），如果市场休眠则不执行交易
- **禁用时（未勾选状态）**：系统将忽略市场休眠判断，始终认为市场可交易

## 在GUI界面中找到市场休眠开关

### 步骤1：启动应用

双击 `启动应用.command` 或在终端运行：
```bash
python3 eth_fakeout_gui.py
```

### 步骤2：登录系统

1. 在「🔐 登录」标签页输入币安API Key和API Secret
2. 点击"登录"按钮
3. 登录成功后会自动跳转到监控页面

### 步骤3：打开参数配置

1. 点击顶部标签栏的「⚙️ 参数配置」标签页
2. 等待参数加载完成（约1-2秒）

### 步骤4：找到市场休眠开关

**位置**：在参数配置页面向下滚动，找到「**市场状态引擎参数**」组

市场休眠开关位于该参数组的**底部**，特点如下：

- **标题**：市场休眠过滤开关
- **类型**：复选框（✓）
- **描述**：⚡ 市场休眠过滤开关（启用后，市场处于休眠状态时将不执行交易）
- **默认状态**：✓ 已勾选（启用）

### 视觉参考

```
╔════════════════════════════════════════════════════╗
║  市场状态引擎参数                                    ║
╠════════════════════════════════════════════════════╣
║                                                      ║
║  volatility_window    [14]    波动率计算窗口 (7-21) ║
║  trend_ma_fast        [7]     快速均线周期 (5-15)   ║
║  trend_ma_slow        [25]    慢速均线周期 (15-35)  ║
║  volume_ma_period     [20]    成交量均线周期 (10-30) ║
║  ────────────────────────────────────────────────  ║
║  ✓ 市场休眠过滤开关  ⚡ 市场休眠过滤开关（启用...）  ║
║                                                      ║
╚════════════════════════════════════════════════════╝
```

## 使用建议

### 何时应该启用市场休眠过滤（默认）？

- ✅ 希望过滤低质量交易机会
- ✅ 偏好稳健交易，避免在平静市场浪费时间
- ✅ 希望减少无效交易和手续费
- ✅ 交易策略不适合低波动市场

### 何时应该禁用市场休眠过滤？

- ✅ 希望最大化交易机会
- ✅ 策略能够处理低波动市场的假突破
- ✅ 需要在所有市场条件下测试策略
- ✅ 认为市场休眠判断过于严格，遗漏了有效机会

## 参数保存和应用

### 修改开关状态

1. 点击复选框切换状态（勾选/取消勾选）
2. 界面不会立即生效，需要保存配置

### 保存并应用参数

1. 点击页面底部的「**💾 保存并应用**」按钮
2. 系统会提示"参数已保存并应用"
3. 市场休眠开关的状态会立即应用到运行中的策略
4. 无需重启系统，实时生效

### 重置为默认值

如果需要恢复默认设置：
1. 点击「**🔄 重置为默认值**」按钮
2. 确认重置操作
3. 市场休眠开关会恢复为勾选状态（启用）

## 参数配置标签页结构

为了方便查找，以下是参数配置页面的完整结构：

```
┌─────────────────────────────────────────┐
│ ⚙️ 参数配置                             │
├─────────────────────────────────────────┤
│ 1. 假突破策略参数                        │
│ 2. 风险管理参数                          │
│ 3. 交易价值过滤参数                      │
│ 4. 执行闸门参数                          │
│ 5. 市场状态引擎参数  ← 市场休眠开关在这里 │
│ 6. 系统运行参数                          │
├─────────────────────────────────────────┤
│ [💾 保存并应用] [🔄 重置为默认值] [📋 导出] │
└─────────────────────────────────────────┘
```

## 滚动提示

如果看不到市场休眠开关：

1. **使用鼠标滚轮**：将鼠标放在参数区域，滚动滚轮向下查看
2. **使用滚动条**：使用右侧的滚动条向下拖动
3. **调整窗口大小**：最大化窗口可以显示更多内容

## 常见问题

### Q1: 为什么我看不到市场休眠开关？

**A**: 请确保：
- 已正确打开「⚙️ 参数配置」标签页
- 向下滚动到「市场状态引擎参数」组
- 参数组位于页面中下部，需要滚动查看

### Q2: 修改开关状态后没有生效？

**A**: 请确保：
- 已点击「💾 保存并应用」按钮
- 等待"参数已保存并应用"的提示
- 检查日志窗口确认参数更新成功

### Q3: 如何确认市场休眠过滤是否正在工作？

**A**: 查看监控标签页的日志：
- 启用时会看到："跳过: 市场休眠"
- 禁用时不会看到此日志
- 市场状态标签会显示当前状态（休眠/活跃/激进）

### Q4: 市场休眠开关和实盘/模拟模式有关系吗？

**A**: 没有直接关系：
- 市场休眠开关：控制是否过滤市场休眠状态
- 实盘/模拟模式：控制是否执行真实交易
- 两者可以独立使用，互不影响

## 技术实现

市场休眠开关的实现涉及以下代码文件：

1. **parameter_config.py**: 参数配置管理
   - `MarketStateEngineConfig.enable_market_sleep_filter`

2. **market_state_engine.py**: 市场状态引擎
   - `MarketStateEngine.set_sleep_filter()`
   - `MarketStateEngine.get_sleep_filter_status()`

3. **eth_fakeout_gui.py**: GUI界面
   - 复选框位于「市场状态引擎参数」组底部
   - 支持实时参数更新

4. **eth_fakeout_strategy_system.py**: 策略系统
   - 参数动态更新机制

## 更新日志

- **2026-01-08**: 添加市场休眠限制开关功能，支持用户手动控制是否启用市场休眠过滤
- **2026-01-08**: 优化GUI显示，复选框文字更友好，添加鼠标滚轮支持

## 联系支持

如有问题或建议，请查看：
- 项目README.md
- 自动交易故障排查指南
- 提交Issue或Pull Request
