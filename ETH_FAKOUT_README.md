# ETH 5m 假突破策略系统

## 📋 策略概述

ETH 5m假突破策略是一个自动化交易系统，专注于识别和利用以太坊（ETH）期货市场中的假突破（Fakeout）机会。

### 核心思想

程序的核心不是寻找交易，而是持续排除不值得交易的状态。通过多层过滤机制，只在高质量机会时执行交易。

### 策略原理

1. **结构位识别**：识别摆动高点（Swing High）和摆动低点（Swing Low）
2. **假突破检测**：价格突破结构位后未能延续，出现回落/回升
3. **多层过滤**：市场状态 → 交易价值 → 结构位置 → 假突破识别 → 执行闸门 → 风险管理

## 🏗️ 系统架构

```
ETH 5m假突破策略系统
├── 数据层 (DataFetcher)
│   ├── K线数据获取
│   ├── 资金费率查询
│   ├── 价格和点差
│   └── ATR计算
├── 市场状态引擎 (MarketStateEngine)
│   ├── SLEEP - 休眠
│   ├── ACTIVE - 活跃
│   └── AGGRESSIVE - 激进
├── 交易价值过滤器 (WorthTradingFilter)
│   ├── 成本计算
│   ├── 盈亏比评估
│   └── 仓位计算
├── 假突破策略引擎 (FakeoutStrategy)
│   ├── 结构位识别
│   ├── 突破检测
│   └── 假突破确认
├── 执行闸门 (ExecutionGate)
│   ├── 交易频率校验
│   ├── 持仓数量检查
│   └── 止损距离验证
├── 风险管理器 (RiskManager)
│   ├── PnL跟踪
│   ├── 连续亏损监控
│   └── 熔断机制
├── 主循环系统 (ETHFakeoutStrategySystem)
│   ├── 事件驱动
│   ├── 永久在线循环
│   └── 异常处理
└── GUI应用 (ETHFakeoutGUI)
    ├── 登录界面
    ├── 市场监控
    ├── 信号显示
    ├── 风险管理
    └── 自动交易
```

## 🎯 核心功能

### 1. 数据层

- **K线数据**：获取1m/5m K线，支持多周期
- **资金费率**：实时获取Funding费率
- **价格数据**：当前价格、点差
- **技术指标**：ATR、成交量MA
- **数据新鲜度**：检测数据延迟

### 2. 市场状态引擎

根据ATR、成交量、Funding将市场划分为三种状态：

- **SLEEP（休眠）**：市场平静，不适合交易
  - ATR < 0.5%
  - 成交量低迷
  - 负资金费率

- **ACTIVE（活跃）**：市场有波动，适合正常交易
  - 正常波动范围
  - 成交量活跃

- **AGGRESSIVE（激进）**：市场剧烈波动，适合激进策略
  - ATR > 2%
  - 放量突破
  - 正资金费率

### 3. 交易价值过滤器

在策略前判断波动是否足以覆盖交易成本：

- **交易成本**：手续费 + 点差 + 滑点 + 资金费率
- **最小盈亏比**：2:1
- **最小预期波动**：0.5%
- **仓位计算**：基于风险的动态仓位

### 4. 假突破策略引擎

识别结构极值与失败突破：

**结构位识别**：
- 使用摆动点检测算法
- 识别关键的高低点
- 保留最近20个结构位

**假突破识别**：

**多头假突破（做多机会）**：
1. 价格向上突破摆动高点
2. 随后回落跌破结构位
3. 出现长下影线确认
4. 生成买入信号

**空头假突破（做空机会）**：
1. 价格向下突破摆动低点
2. 随后回升涨回结构位
3. 出现长上影线确认
4. 生成卖出信号

### 5. 执行闸门

多重校验机制：

- **交易频率**：最小间隔10分钟
- **持仓数量**：最多3个同时持仓
- **K线实体**：避免在极小实体K线交易
- **止损距离**：最小1%的止损距离

### 6. 风险管理器

维护PnL、连续亏损、熔断状态（优先级最高）：

**风险指标**：
- 总交易次数
- 胜率
- 总盈亏
- 最大回撤
- 连续亏损次数
- 平均盈利/亏损

**熔断机制**：
- 最大回撤 > 10%
- 连续亏损 >= 3次
- 每日亏损 > 50 USDT

熔断触发后暂停交易30分钟。

### 7. 主循环

事件驱动 + 永久在线循环方式运行：

```
每10秒执行一次完整周期：
1. 系统健康检查
2. 全局熔断检查
3. 市场状态判断（非SLEEP）
4. 交易价值判断
5. 结构位置过滤
6. 假突破识别
7. 执行条件校验
8. 下单执行
9. 持仓管理
```

## 📊 主循环决策流程

```
系统启动
    ↓
【循环开始】
    ↓
系统健康检查（心跳、数据新鲜度）
    ↓
全局熔断检查
    ↓
交易价值判断（Worth-Trading）
    ↓
市场状态判断（非SLEEP）
    ↓
结构位置过滤
    ↓
假突破识别
    ↓
执行条件校验
    ↓
下单执行
    ↓
持仓管理
    ↓
短暂休眠（10秒）
    ↓
【回到循环开始】
```

## 🚀 快速开始

### 前置要求

1. **Python 3.6+**
2. **依赖库**：
   ```bash
   pip3 install requests cryptography python-docx
   ```

### 创建币安API密钥

1. 登录币安账户
2. 进入「API管理」
3. 创建新API密钥
4. **启用期货交易权限**
5. 保存API Key和Secret

### 运行系统

#### 方法一：双击运行（推荐）

```bash
双击 '启动假突破策略.command' 文件
```

#### 方法二：命令行运行

```bash
python3 eth_fakeout_gui.py
```

### 首次使用流程

1. **登录系统**
   - 输入API Key和Secret
   - 勾选"保存凭证"
   - 点击"登录系统"

2. **查看市场状态**
   - 切换到"市场监控"标签页
   - 查看当前市场状态（SLEEP/ACTIVE/AGGRESSIVE）
   - 查看ATR、成交量、资金费率等指标

3. **查看假突破信号**
   - 切换到"假突破信号"标签页
   - 点击"刷新信号"查看最新信号
   - 查看入场价、止损、止盈

4. **启动自动交易**
   - 切换到"自动交易"标签页
   - **重要**：确保勾选"模拟模式"
   - 点击"启动策略"
   - 观察实时日志

5. **风险管理**
   - 切换到"风险管理"标签页
   - 查看交易统计
   - 查看盈亏情况
   - 必要时重置熔断

## 💡 界面说明

### 登录界面

- API Key和Secret输入
- 凭证加密保存
- 登录状态显示

### 市场监控

- 系统状态显示
- 市场状态（SLEEP/ACTIVE/AGGRESSIVE）
- 市场指标（ATR、成交量、资金费率、活跃评分）
- 启动/停止策略按钮
- 模拟模式开关
- 实时日志

### 假突破信号

- 信号数量统计
- 信号表格（时间、类型、入场价、止损、止盈、置信度、原因）
- 刷新信号按钮

### 风险管理

- 交易统计卡片
- 盈亏统计卡片
- 风险控制卡片
- 熔断重置按钮

### 自动交易

- 策略说明
- 策略统计（循环次数、发现信号、执行交易、各环节跳过次数）

## 🔒 安全说明

### API密钥安全

1. **本地加密存储**：使用Fernet加密算法
2. **密钥文件分离**：加密密钥独立存储
3. **权限控制**：建议只读或有限权限的API密钥
4. **禁用提现**：API密钥不应有提现权限

### 交易安全

1. **模拟模式**：首次使用必须启用模拟模式
2. **风险控制**：
   - 最大回撤限制：10%
   - 连续亏损限制：3次
   - 每日亏损限制：50 USDT
3. **充分测试**：模拟模式测试1周以上再考虑实盘

### 系统安全

1. **网络连接**：确保网络稳定
2. **异常处理**：任何异常不会导致程序退出
3. **熔断机制**：极端情况下自动暂停交易

## ⚙️ 参数配置

### 市场状态引擎参数

```python
atr_period = 14                          # ATR周期
volume_ma_period = 20                    # 成交量MA周期
atr_sleep_threshold = 0.005             # SLEEP阈值（0.5%）
atr_active_threshold = 0.02             # AGGRESSIVE阈值（2%）
volume_active_multiplier = 1.5           # 活跃成交量倍数
```

### 交易价值过滤器参数

```python
min_rr_ratio = 2.0                       # 最小盈亏比
min_expected_move = 0.005                # 最小预期波动（0.5%）
cost_multiplier = 2.0                   # 成本倍数
risk_per_trade = 0.02                    # 单笔风险（2%）
```

### 假突破策略参数

```python
swing_period = 3                         # 摆动点检测周期
breakout_confirmation = 2               # 突破确认K线数
fakeout_confirmation = 1                # 假突破确认K线数
min_body_ratio = 0.3                     # K线实体占比
```

### 执行闸门参数

```python
min_trade_interval = 10分钟              # 最小交易间隔
max_positions = 3                        # 最大持仓数
min_stop_loss_distance = 0.01            # 最小止损距离（1%）
```

### 风险管理器参数

```python
max_drawdown_percent = 10.0              # 最大回撤百分比
max_consecutive_losses = 3               # 最大连续亏损次数
daily_loss_limit = 50.0                  # 每日亏损限制（USDT）
```

## 📈 策略特点

### 优势

1. **多层过滤**：通过7层过滤确保高质量交易机会
2. **假突破优势**：假突破的成功率通常高于真突破
3. **风险优先**：风险管理优先级最高，熔断机制保护资金
4. **全天运行**：24小时自动运行，根据市场状态调整
5. **可回测**：所有规则清晰，便于回测和优化

### 适用场景

- 市场震荡区间
- 关键阻力位/支撑位附近
- 成交量放大的假突破
- 资金费率极端时

### 不适用场景

- 单边趋势市场（假突破少）
- 极低波动市场（ATR过小）
- 极高波动市场（止损距离过大）

## ❓ 常见问题

### Q1: 为什么找不到假突破信号？

**A**: 可能的原因：
- 市场处于SLEEP状态，系统跳过交易
- 没有明显的结构位被突破
- 突破后没有出现假突破
- 市场状态、交易价值等前置条件未满足

### Q2: 模拟模式下会扣减资金吗？

**A**: 不会。模拟模式下：
- 不会实际下单
- 不会扣减资金
- 仅记录日志供查看

### Q3: 熔断后如何恢复？

**A**: 有两种方式：
1. 等待30分钟后自动恢复
2. 手动点击"重置熔断"按钮立即恢复

### Q4: 如何调整策略参数？

**A**: 可以在代码中修改相应模块的参数：
- `market_state_engine.py`：市场状态参数
- `worth_trading_filter.py`：交易价值参数
- `fakeout_strategy.py`：假突破策略参数
- `risk_manager.py`：风险管理参数

### Q5: 如何回测策略？

**A**: 策略逻辑清晰，可以：
1. 使用历史K线数据
2. 模拟主循环执行
3. 记录所有信号和交易
4. 计算收益和风险指标

### Q6: 系统稳定吗？

**A**: 系统设计有多重保护：
- 所有异常都被捕获，不会导致程序退出
- 熔断机制保护资金安全
- 数据新鲜度检测避免使用过期数据
- 心跳检查确保API连接正常

## 📝 后续优化

- [ ] 添加回测功能
- [ ] 添加K线图表显示
- [ ] 优化假突破识别算法
- [ ] 添加更多形态识别（双底双顶等）
- [ ] 添加机器学习辅助判断
- [ ] 支持多币种交易
- [ ] 添加策略性能统计
- [ ] 添加通知功能（邮件/Telegram）
- [ ] 支持多账户管理

## 📄 免责声明

本系统仅供学习和研究使用，不构成投资建议。使用本系统进行实盘交易存在资金损失风险。使用币安API需要遵守币安的服务条款和API使用规范。

**作者不对因使用本系统造成的任何损失负责。**

使用前请确保：
1. 充分理解策略原理
2. 在模拟模式下充分测试
3. 不要投入无法承受损失的资金
4. 遵守当地法律法规

## 📞 技术支持

如有问题或建议，欢迎反馈。

---

**祝交易顺利！** 🚀📈
